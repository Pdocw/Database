# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'score_modify_ui.ui'
#
# Created by: PyQt5 UI code generator 5.15.2
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.


from PyQt5 import QtCore, QtGui, QtWidgets
import pyodbc

class Ui_Window_score_modify(object):
    def setupUi(self, Window_score_modify):
        Window_score_modify.setObjectName("Window_score_modify")
        Window_score_modify.resize(1280, 720)
        Window_score_modify.setMinimumSize(QtCore.QSize(1280, 720))
        Window_score_modify.setMaximumSize(QtCore.QSize(1280, 720))
        self.label_title9 = QtWidgets.QLabel(Window_score_modify)
        self.label_title9.setGeometry(QtCore.QRect(740, 430, 100, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_title9.setFont(font)
        self.label_title9.setObjectName("label_title9")
        self.label_stuname = QtWidgets.QLabel(Window_score_modify)
        self.label_stuname.setGeometry(QtCore.QRect(870, 110, 301, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_stuname.setFont(font)
        self.label_stuname.setText("")
        self.label_stuname.setObjectName("label_stuname")
        self.label_title10 = QtWidgets.QLabel(Window_score_modify)
        self.label_title10.setGeometry(QtCore.QRect(740, 170, 100, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_title10.setFont(font)
        self.label_title10.setObjectName("label_title10")
        self.label_title7 = QtWidgets.QLabel(Window_score_modify)
        self.label_title7.setGeometry(QtCore.QRect(140, 540, 100, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_title7.setFont(font)
        self.label_title7.setObjectName("label_title7")
        self.pushButton_modify = QtWidgets.QPushButton(Window_score_modify)
        self.pushButton_modify.setGeometry(QtCore.QRect(590, 540, 200, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.pushButton_modify.setFont(font)
        self.pushButton_modify.setObjectName("pushButton_modify")
        self.lineEdit_stuno = QtWidgets.QLineEdit(Window_score_modify)
        self.lineEdit_stuno.setGeometry(QtCore.QRect(270, 110, 300, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.lineEdit_stuno.setFont(font)
        self.lineEdit_stuno.setObjectName("lineEdit_stuno")
        self.label_coursename = QtWidgets.QLabel(Window_score_modify)
        self.label_coursename.setGeometry(QtCore.QRect(870, 370, 301, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_coursename.setFont(font)
        self.label_coursename.setText("")
        self.label_coursename.setObjectName("label_coursename")
        self.lineEdit_score = QtWidgets.QLineEdit(Window_score_modify)
        self.lineEdit_score.setGeometry(QtCore.QRect(270, 540, 300, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.lineEdit_score.setFont(font)
        self.lineEdit_score.setObjectName("lineEdit_score")
        self.label_stuage = QtWidgets.QLabel(Window_score_modify)
        self.label_stuage.setGeometry(QtCore.QRect(870, 230, 301, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_stuage.setFont(font)
        self.label_stuage.setText("")
        self.label_stuage.setObjectName("label_stuage")
        self.pushButton_stuno_inquiry = QtWidgets.QPushButton(Window_score_modify)
        self.pushButton_stuno_inquiry.setGeometry(QtCore.QRect(590, 110, 100, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.pushButton_stuno_inquiry.setFont(font)
        self.pushButton_stuno_inquiry.setObjectName("pushButton_stuno_inquiry")
        self.label_title1 = QtWidgets.QLabel(Window_score_modify)
        self.label_title1.setGeometry(QtCore.QRect(565, 20, 200, 60))
        self.label_title1.setMaximumSize(QtCore.QSize(16777214, 16777215))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(28)
        self.label_title1.setFont(font)
        self.label_title1.setObjectName("label_title1")
        self.label_title3 = QtWidgets.QLabel(Window_score_modify)
        self.label_title3.setGeometry(QtCore.QRect(140, 370, 100, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_title3.setFont(font)
        self.label_title3.setObjectName("label_title3")
        self.label_title8 = QtWidgets.QLabel(Window_score_modify)
        self.label_title8.setGeometry(QtCore.QRect(740, 230, 100, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_title8.setFont(font)
        self.label_title8.setObjectName("label_title8")
        self.lineEdit_cno = QtWidgets.QLineEdit(Window_score_modify)
        self.lineEdit_cno.setGeometry(QtCore.QRect(270, 370, 300, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.lineEdit_cno.setFont(font)
        self.lineEdit_cno.setObjectName("lineEdit_cno")
        self.label_title6 = QtWidgets.QLabel(Window_score_modify)
        self.label_title6.setGeometry(QtCore.QRect(740, 290, 100, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_title6.setFont(font)
        self.label_title6.setObjectName("label_title6")
        self.label_stuclass = QtWidgets.QLabel(Window_score_modify)
        self.label_stuclass.setGeometry(QtCore.QRect(870, 170, 301, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_stuclass.setFont(font)
        self.label_stuclass.setText("")
        self.label_stuclass.setObjectName("label_stuclass")
        self.label_credit = QtWidgets.QLabel(Window_score_modify)
        self.label_credit.setGeometry(QtCore.QRect(870, 430, 301, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_credit.setFont(font)
        self.label_credit.setText("")
        self.label_credit.setObjectName("label_credit")
        self.label_course_tip = QtWidgets.QLabel(Window_score_modify)
        self.label_course_tip.setGeometry(QtCore.QRect(150, 430, 521, 41))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_course_tip.setFont(font)
        self.label_course_tip.setText("")
        self.label_course_tip.setObjectName("label_course_tip")
        self.pushButton_course_inquiry = QtWidgets.QPushButton(Window_score_modify)
        self.pushButton_course_inquiry.setGeometry(QtCore.QRect(590, 370, 100, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.pushButton_course_inquiry.setFont(font)
        self.pushButton_course_inquiry.setObjectName("pushButton_course_inquiry")
        self.label_title2 = QtWidgets.QLabel(Window_score_modify)
        self.label_title2.setGeometry(QtCore.QRect(140, 110, 100, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_title2.setFont(font)
        self.label_title2.setObjectName("label_title2")
        self.label_stusex = QtWidgets.QLabel(Window_score_modify)
        self.label_stusex.setGeometry(QtCore.QRect(870, 290, 301, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_stusex.setFont(font)
        self.label_stusex.setText("")
        self.label_stusex.setObjectName("label_stusex")
        self.label_title5 = QtWidgets.QLabel(Window_score_modify)
        self.label_title5.setGeometry(QtCore.QRect(740, 370, 100, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_title5.setFont(font)
        self.label_title5.setObjectName("label_title5")
        self.label_stuno_tip = QtWidgets.QLabel(Window_score_modify)
        self.label_stuno_tip.setGeometry(QtCore.QRect(160, 170, 521, 41))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_stuno_tip.setFont(font)
        self.label_stuno_tip.setText("")
        self.label_stuno_tip.setObjectName("label_stuno_tip")
        self.label_title4 = QtWidgets.QLabel(Window_score_modify)
        self.label_title4.setGeometry(QtCore.QRect(740, 110, 100, 40))
        font = QtGui.QFont()
        font.setFamily("黑体")
        font.setPointSize(16)
        self.label_title4.setFont(font)
        self.label_title4.setObjectName("label_title4")

        self.retranslateUi(Window_score_modify)
        QtCore.QMetaObject.connectSlotsByName(Window_score_modify)

        self.pushButton_stuno_inquiry.clicked.connect(lambda: self.sno_inquiry())
        self.pushButton_course_inquiry.clicked.connect(lambda: self.cno_inquiry())
        self.pushButton_modify.clicked.connect(lambda: self.modify())

    def retranslateUi(self, Window_score_modify):
        _translate = QtCore.QCoreApplication.translate
        Window_score_modify.setWindowTitle(_translate("Window_score_modify", "Form"))
        self.label_title9.setText(_translate("Window_score_modify", "学  分："))
        self.label_title10.setText(_translate("Window_score_modify", "班  级："))
        self.label_title7.setText(_translate("Window_score_modify", "成  绩："))
        self.pushButton_modify.setText(_translate("Window_score_modify", "确认修改成绩"))
        self.pushButton_stuno_inquiry.setText(_translate("Window_score_modify", "查询"))
        self.label_title1.setText(_translate("Window_score_modify", "修改成绩"))
        self.label_title3.setText(_translate("Window_score_modify", "课程号："))
        self.label_title8.setText(_translate("Window_score_modify", "年  龄："))
        self.label_title6.setText(_translate("Window_score_modify", "性  别："))
        self.pushButton_course_inquiry.setText(_translate("Window_score_modify", "查询"))
        self.label_title2.setText(_translate("Window_score_modify", "学  号："))
        self.label_title5.setText(_translate("Window_score_modify", "课程名："))
        self.label_title4.setText(_translate("Window_score_modify", "姓  名："))

    def sno_inquiry(self):

        sno = self.lineEdit_stuno.text()
        conn = pyodbc.connect(r'DRIVER={SQL Server Native Client 11.0};'
                              r'SERVER=Beta;'
                              r'DATABASE=Curriculum_design;'
                              r'UID=Pdocw;'
                              r'PWD=123456'
                              )
        cur = conn.cursor()
        if sno != '':
            cur.execute('SELECT * FROM xsxx WHERE Sno =' + sno)
        else:
            return
        row = cur.fetchone()
        if not row:
            self.label_stuno_tip.setText("不存在该学生")
            self.label_stuno_tip.setStyleSheet('color:rgb(255, 0, 0)')
            conn.commit()
            conn.close()
        else:
            self.label_stuno_tip.setText("")
            self.label_stuname.setText(row[1])
            self.label_stusex.setText(row[2])
            self.label_stuclass.setText(row[3])
            self.label_stuage.setText(str(row[4]))
            conn.commit()
            conn.close()

    def cno_inquiry(self):
        sno = self.lineEdit_stuno.text()
        cno = self.lineEdit_cno.text()
        conn = pyodbc.connect(r'DRIVER={SQL Server Native Client 11.0};'
                              r'SERVER=Beta;'
                              r'DATABASE=Curriculum_design;'
                              r'UID=Pdocw;'
                              r'PWD=123456'
                              )
        cur = conn.cursor()
        if cno != '':
            cur.execute("SELECT * FROM (select xxxx.*, kc.Cname, kc.Credit from xxxx, kc where xxxx.Cno = kc.Cno) as xxxx_kc WHERE Cno ='" + cno + "' and Sno ='" + sno + "'")
        else:
            return
        row = cur.fetchone()
        if not row:
            self.label_coursename.setText("")
            self.label_credit.setText("")
            self.label_course_tip.setText("该学生无此课程！")
            self.label_course_tip.setStyleSheet('color:rgb(255, 0, 0)')
            conn.commit()
            conn.close()
        else:
            self.label_course_tip.setText("")
            self.label_coursename.setText(row[3])
            self.label_credit.setText(str(row[4]))
            conn.commit()
            conn.close()

    def modify(self):
        sno = self.lineEdit_stuno.text()
        cno = self.lineEdit_cno.text()
        score = self.lineEdit_score.text()
        conn = pyodbc.connect(r'DRIVER={SQL Server Native Client 11.0};'
                              r'SERVER=Beta;'
                              r'DATABASE=Curriculum_design;'
                              r'UID=Pdocw;'
                              r'PWD=123456'
                              )

        print(1)
        cur = conn.cursor()
        if score != '':
            cur.execute("SELECT * FROM xxxx WHERE Sno ='" + sno + "' and Cno ='" + cno + "'")
            print(2)
        else:
            return
        print(5)
        row_xxxx = cur.fetchone()
        print(row_xxxx)
        if row_xxxx:  # 如果有这门课的成绩
            # cur_cjpm.execute("SELECT * FROM cjpm WHERE Sno ='" + sno + "'")
            print(9)

            cur.execute("update cjpm set TotalScore -= " + str(row_xxxx[2]) + "WHERE Sno ='" + sno + "'")
            conn.commit()
            cur.execute("update cjpm set TotalScore += " + score + "WHERE Sno ='" + sno + "'")

            cur.execute("update xxxx set Score -= " + str(row_xxxx[2]) + "WHERE Sno ='" + sno + "' and Cno ='" + cno + "'")
            conn.commit()
            cur.execute("update xxxx set Score += " + score + "WHERE Sno ='" + sno + "' and Cno ='" + cno + "'")
            conn.commit()
            conn.close()
        else:
            conn.commit()
            conn.close()